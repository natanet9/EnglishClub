{% extends 'base.html' %}
{% block title %}Registrar Usuario Administrativo{% endblock %}

{% block content %}
<!-- Bootstrap CSS e Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

<div class="admin-container">
  <div class="container-fluid px-4">
    <div class="row justify-content-center">
      <div class="col-12">
        
        <!-- Header Section -->
        <div class="header-section">
          <div class="header-icon">
            <i class="bi bi-person-badge"></i>
          </div>
          <h1 class="header-title">Registro de Usuario Administrativo</h1>
          <div class="header-divider"></div>
        </div>

        <!-- Main Form -->
        <div class="form-container">
          
          <!-- Success Message -->
          {% if messages %}
            {% for message in messages %}
              <div class="alert alert-{{ message.tags }} alert-dismissible fade show success-section" role="alert">
                <div class="success-header">
                  <i class="bi bi-check-circle-fill"></i>
                  <span>{{ message }}</span>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
              </div>
            {% endfor %}
          {% endif %}

          <!-- Error Messages -->
          {% if form.errors %}
            <div class="error-section">
              <div class="error-header">
                <i class="bi bi-exclamation-triangle-fill"></i>
                <span>Se encontraron errores en el formulario</span>
              </div>
              <ul class="error-list">
                {% for field in form %}
                  {% for error in field.errors %}
                    <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                  {% endfor %}
                {% endfor %}
                {% for error in form.non_field_errors %}
                  <li>{{ error }}</li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}

          <form method="post" enctype="multipart/form-data" id="adminForm" class="admin-form" novalidate>
            {% csrf_token %}
            
            <!-- Section 1: Credenciales de Acceso -->
            <div class="form-section">
              <div class="section-title">
                <div class="section-number">01</div>
                <div class="section-info">
                  <h3>Credenciales de Acceso</h3>
                  <p>Información de login del sistema</p>
                </div>
                <i class="bi bi-shield-lock section-icon"></i>
              </div>
              
              <div class="fields-grid">
                <div class="field-group">
                  <label class="field-label">
                    <i class="bi bi-person"></i>
                    <span>Usuario</span>
                    <small class="auto-text">(Generado automáticamente)</small>
                    <span class="required">*</span>
                  </label>
                  <div class="field-wrapper">
                    {{ form.username }}
                    <div class="field-indicator"></div>
                    <div class="field-hint">Se genera automáticamente basado en nombre, apellido y cédula</div>
                  </div>
                </div>
                
                <div class="field-group">
                  <label class="field-label">
                    <i class="bi bi-lock"></i>
                    <span>Contraseña</span>
                    <span class="required">*</span>
                  </label>
                  <div class="field-wrapper">
                    {{ form.password }}
                    <button type="button" class="password-toggle" id="togglePassword">
                      <i class="bi bi-eye"></i>
                    </button>
                    <div class="field-indicator"></div>
                    <div class="password-strength" id="passwordStrength"></div>
                    <div class="field-hint">Mínimo 8 caracteres, incluya mayúsculas, minúsculas y números</div>
                  </div>
                </div>

                <div class="field-group">
                  <label class="field-label">
                    <i class="bi bi-lock-fill"></i>
                    <span>Confirmar Contraseña</span>
                    <span class="required">*</span>
                  </label>
                  <div class="field-wrapper">
                    <input type="password" name="confirm_password" id="id_confirm_password" class="form-control" required>
                    <button type="button" class="password-toggle" id="toggleConfirmPassword">
                      <i class="bi bi-eye"></i>
                    </button>
                    <div class="field-indicator"></div>
                    <div class="field-feedback" id="passwordMatch"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Section 2: Información Personal -->
            <div class="form-section">
              <div class="section-title">
                <div class="section-number">02</div>
                <div class="section-info">
                  <h3>Información Personal</h3>
                  <p>Datos personales del administrativo</p>
                </div>
                <i class="bi bi-person-vcard section-icon"></i>
              </div>
              
              <div class="fields-grid">
                <div class="field-group">
                  <label class="field-label">
                    <i class="bi bi-person"></i>
                    <span>Nombres</span>
                    <span class="required">*</span>
                  </label>
                  <div class="field-wrapper">
                    {{ form.nombre }}
                    <div class="field-indicator"></div>
                    <div class="field-feedback"></div>
                  </div>
                </div>
                
                <div class="field-group">
                  <label class="field-label">
                    <i class="bi bi-person"></i>
                    <span>Apellidos</span>
                    <span class="required">*</span>
                  </label>
                  <div class="field-wrapper">
                    {{ form.apellidos }}
                    <div class="field-indicator"></div>
                    <div class="field-feedback"></div>
                  </div>
                </div>
                
                <div class="field-group">
                  <label class="field-label">
                    <i class="bi bi-card-text"></i>
                    <span>Cédula de Identidad</span>
                    <span class="required">*</span>
                  </label>
                  <div class="field-wrapper">
                    {{ form.carnet }}
                    <div class="field-indicator"></div>
                    <div class="field-feedback"></div>
                    <div class="field-hint">Solo números, sin espacios ni guiones</div>
                  </div>
                </div>
                
                <div class="field-group">
                  <label class="field-label">
                    <i class="bi bi-calendar-heart"></i>
                    <span>Fecha de Nacimiento</span>
                    <span class="required">*</span>
                  </label>
                  <div class="field-wrapper">
                    {{ form.fecha_nacimiento }}
                    <div class="field-indicator"></div>
                    <div class="field-feedback"></div>
                  </div>
                </div>
                
                <div class="field-group col-span-2">
                  <label class="field-label">
                    <i class="bi bi-house-door"></i>
                    <span>Domicilio</span>
                    <span class="required">*</span>
                  </label>
                  <div class="field-wrapper">
                    {{ form.domicilio }}
                    <div class="field-indicator"></div>
                    <div class="field-feedback"></div>
                  </div>
                </div>
                
                <div class="field-group col-span-2">
                  <label class="field-label">
                    <i class="bi bi-briefcase"></i>
                    <span>Ocupación</span>
                    <span class="required">*</span>
                  </label>
                  <div class="field-wrapper">
                    {{ form.ocupacion }}
                    <div class="field-indicator"></div>
                    <div class="field-feedback"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Section 3: Información de Contacto -->
            <div class="form-section">
              <div class="section-title">
                <div class="section-number">03</div>
                <div class="section-info">
                  <h3>Información de Contacto</h3>
                  <p>Datos de contacto y rol en el sistema</p>
                </div>
                <i class="bi bi-telephone section-icon"></i>
              </div>
              
              <div class="fields-grid">
                <div class="field-group">
                  <label class="field-label">
                    <i class="bi bi-envelope"></i>
                    <span>Correo Electrónico</span>
                    <span class="required">*</span>
                  </label>
                  <div class="field-wrapper">
                    {{ form.direccion }}
                    <div class="field-indicator"></div>
                    <div class="field-feedback"></div>
                    <div class="field-hint">ejemplo@dominio.com</div>
                  </div>
                </div>
                
                <div class="field-group">
                  <label class="field-label">
                    <i class="bi bi-phone"></i>
                    <span>Teléfono</span>
                    <span class="required">*</span>
                  </label>
                  <div class="field-wrapper">
                    {{ form.telefono }}
                    <div class="field-indicator"></div>
                    <div class="field-feedback"></div>
                    <div class="field-hint">Formato: 70123456 o 2-2123456</div>
                  </div>
                </div>
                
                <div class="field-group col-span-2">
                  <label class="field-label">
                    <i class="bi bi-award"></i>
                    <span>Rol Administrativo</span>
                    <span class="required">*</span>
                  </label>
                  <div class="field-wrapper">
                    {{ form.rol }}
                    <div class="field-indicator"></div>
                    <div class="field-feedback"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Submit Section -->
            <div class="submit-section">
              <div class="form-summary">
                <h4><i class="bi bi-info-circle"></i> Resumen del Registro</h4>
                <p>Verifique que todos los datos estén correctos antes de proceder con el registro.</p>
              </div>
              
              <button type="submit" class="submit-btn" id="submitBtn">
                <div class="btn-content">
                  <i class="bi bi-check-circle-fill"></i>
                  <span>Registrar Usuario Administrativo</span>
                </div>
                <div class="btn-loading" style="display: none;">
                  <i class="bi bi-arrow-clockwise spin"></i>
                  <span>Procesando registro...</span>
                </div>
              </button>
              
              <div class="submit-info">
                <i class="bi bi-shield-check"></i>
                <span>Al registrar, se creará el acceso al sistema administrativo con permisos según el rol asignado</span>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('adminForm');
  const nombreField = form.querySelector('[name="nombre"]');
  const apellidosField = form.querySelector('[name="apellidos"]');
  const carnetField = form.querySelector('[name="carnet"]');
  const usernameField = form.querySelector('[name="username"]');
  const passwordField = form.querySelector('[name="password"]');
  const confirmPasswordField = form.querySelector('#id_confirm_password');

  // Validaciones en tiempo real
  const validations = {
    nombre: {
      pattern: /^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$/,
      minLength: 2,
      message: 'Solo letras y espacios, mínimo 2 caracteres'
    },
    apellidos: {
      pattern: /^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$/,
      minLength: 2,
      message: 'Solo letras y espacios, mínimo 2 caracteres'
    },
    carnet: {
      pattern: /^\d{7,10}$/,
      message: 'Solo números, entre 7 y 10 dígitos'
    },
    direccion: {
      pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/,
      message: 'Formato de email inválido'
    },
    telefono: {
      pattern: /^(\d{8}|\d{1}-\d{7})$/,
      message: 'Formato: 70123456 o 2-2123456'
    }
  };

  // Función para generar username automáticamente
  function generateUsername() {
    const nombre = nombreField.value.trim();
    const apellidos = apellidosField.value.trim();
    const carnet = carnetField.value.trim();

    if (nombre && apellidos && carnet) {
      const primeraLetraNombre = nombre.charAt(0).toLowerCase();
      const primeraLetraApellido = apellidos.charAt(0).toLowerCase();
      const username = primeraLetraNombre + primeraLetraApellido + carnet;
      
      usernameField.value = username;
      usernameField.dispatchEvent(new Event('input', { bubbles: true }));
      
      // Validar disponibilidad del username (simulado)
      validateUsername(username);
    }
  }

  // Validar username (simulación de validación con servidor)
  function validateUsername(username) {
    const feedback = usernameField.closest('.field-wrapper').querySelector('.field-feedback');
    if (!feedback) {
      const feedbackDiv = document.createElement('div');
      feedbackDiv.className = 'field-feedback';
      usernameField.closest('.field-wrapper').appendChild(feedbackDiv);
    }
    
    // Simulación de validación
    setTimeout(() => {
      const feedbackElement = usernameField.closest('.field-wrapper').querySelector('.field-feedback');
      feedbackElement.innerHTML = '<i class="bi bi-check-circle text-success"></i> Usuario disponible';
      feedbackElement.className = 'field-feedback valid';
    }, 500);
  }

  // Configurar campo username
  usernameField.readOnly = true;
  usernameField.style.backgroundColor = '#f8f9fa';
  usernameField.style.cursor = 'not-allowed';

  // Escuchar cambios para generar username
  nombreField.addEventListener('input', generateUsername);
  apellidosField.addEventListener('input', generateUsername);
  carnetField.addEventListener('input', generateUsername);

  // Validación de fortaleza de contraseña
  function checkPasswordStrength(password) {
    const strengthIndicator = document.getElementById('passwordStrength');
    if (!strengthIndicator) return;

    let score = 0;
    let feedback = [];

    if (password.length >= 8) score += 1;
    else feedback.push('Mínimo 8 caracteres');

    if (/[A-Z]/.test(password)) score += 1;
    else feedback.push('Una mayúscula');

    if (/[a-z]/.test(password)) score += 1;
    else feedback.push('Una minúscula');

    if (/\d/.test(password)) score += 1;
    else feedback.push('Un número');

    if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) score += 1;

    const levels = ['Muy débil', 'Débil', 'Regular', 'Fuerte', 'Muy fuerte'];
    const colors = ['#dc2626', '#f59e0b', '#eab308', '#10b981', '#059669'];

    strengthIndicator.innerHTML = `
      <div class="strength-bar">
        <div class="strength-fill" style="width: ${(score/5)*100}%; background: ${colors[score-1] || colors[0]}"></div>
      </div>
      <div class="strength-text" style="color: ${colors[score-1] || colors[0]}">
        ${levels[score-1] || levels[0]}
        ${feedback.length > 0 ? ` - Falta: ${feedback.join(', ')}` : ''}
      </div>
    `;
  }

  // Validar coincidencia de contraseñas
  function checkPasswordMatch() {
    const matchIndicator = document.getElementById('passwordMatch');
    if (!matchIndicator) return;

    const password = passwordField.value;
    const confirmPassword = confirmPasswordField.value;

    if (!confirmPassword) {
      matchIndicator.innerHTML = '';
      return;
    }

    if (password === confirmPassword) {
      matchIndicator.innerHTML = '<i class="bi bi-check-circle text-success"></i> Las contraseñas coinciden';
      matchIndicator.className = 'field-feedback valid';
    } else {
      matchIndicator.innerHTML = '<i class="bi bi-x-circle text-danger"></i> Las contraseñas no coinciden';
      matchIndicator.className = 'field-feedback invalid';
    }
  }

  // Event listeners para contraseñas
  passwordField.addEventListener('input', function() {
    checkPasswordStrength(this.value);
    checkPasswordMatch();
  });

  confirmPasswordField.addEventListener('input', checkPasswordMatch);

  // Toggle visibility de contraseñas
  document.getElementById('togglePassword').addEventListener('click', function() {
    const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
    passwordField.setAttribute('type', type);
    this.querySelector('i').className = type === 'password' ? 'bi bi-eye' : 'bi bi-eye-slash';
  });

  document.getElementById('toggleConfirmPassword').addEventListener('click', function() {
    const type = confirmPasswordField.getAttribute('type') === 'password' ? 'text' : 'password';
    confirmPasswordField.setAttribute('type', type);
    this.querySelector('i').className = type === 'password' ? 'bi bi-eye' : 'bi bi-eye-slash';
  });

  // Validación en tiempo real para todos los campos
  Object.keys(validations).forEach(fieldName => {
    const field = form.querySelector(`[name="${fieldName}"]`);
    if (field) {
      field.addEventListener('input', function() {
        validateField(this, validations[fieldName]);
      });
    }
  });

  function validateField(field, rules) {
    const wrapper = field.closest('.field-wrapper');
    let feedback = wrapper.querySelector('.field-feedback');
    
    if (!feedback) {
      feedback = document.createElement('div');
      feedback.className = 'field-feedback';
      wrapper.appendChild(feedback);
    }

    const value = field.value.trim();
    
    if (!value) {
      feedback.innerHTML = '';
      wrapper.classList.remove('valid', 'invalid');
      return;
    }

    let isValid = true;
    let message = '';

    if (rules.pattern && !rules.pattern.test(value)) {
      isValid = false;
      message = rules.message;
    } else if (rules.minLength && value.length < rules.minLength) {
      isValid = false;
      message = `Mínimo ${rules.minLength} caracteres`;
    }

    if (isValid) {
      feedback.innerHTML = '<i class="bi bi-check-circle text-success"></i> Válido';
      feedback.className = 'field-feedback valid';
      wrapper.classList.add('valid');
      wrapper.classList.remove('invalid');
    } else {
      feedback.innerHTML = `<i class="bi bi-x-circle text-danger"></i> ${message}`;
      feedback.className = 'field-feedback invalid';
      wrapper.classList.add('invalid');
      wrapper.classList.remove('valid');
    }
  }

  // Validación del formulario al enviar
  if (form) {
    form.addEventListener('submit', function(event) {
      let isFormValid = true;

      // Validar que las contraseñas coincidan
      if (passwordField.value !== confirmPasswordField.value) {
        isFormValid = false;
        const matchIndicator = document.getElementById('passwordMatch');
        matchIndicator.innerHTML = '<i class="bi bi-x-circle text-danger"></i> Las contraseñas no coinciden';
        matchIndicator.className = 'field-feedback invalid';
      }

      // Validar todos los campos requeridos
      const requiredFields = form.querySelectorAll('[required]');
      requiredFields.forEach(field => {
        if (!field.value.trim()) {
          isFormValid = false;
          const wrapper = field.closest('.field-wrapper');
          wrapper.classList.add('error-shake');
          setTimeout(() => wrapper.classList.remove('error-shake'), 600);
        }
      });

      if (!isFormValid) {
        event.preventDefault();
        event.stopPropagation();
        
        // Scroll al primer campo inválido
        const firstInvalid = form.querySelector(':invalid, .invalid input');
        if (firstInvalid) {
          firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
          firstInvalid.focus();
        }
      } else {
        // Mostrar loading
        const submitBtn = document.getElementById('submitBtn');
        const btnContent = submitBtn.querySelector('.btn-content');
        const btnLoading = submitBtn.querySelector('.btn-loading');
        
        btnContent.style.display = 'none';
        btnLoading.style.display = 'flex';
        submitBtn.disabled = true;
      }
      
      form.classList.add('was-validated');
    });

    // Validación para fecha de nacimiento (no antes del año 2000)
const fechaNacimientoField = form.querySelector('[name="fecha_nacimiento"]');

// Configurar fecha mínima permitida (1 de enero de 2000)
if (fechaNacimientoField) {
  fechaNacimientoField.setAttribute('min', '2000-01-01');
  
  // Validación personalizada
  fechaNacimientoField.addEventListener('input', function() {
    const fechaSeleccionada = new Date(this.value);
    const fechaMinima = new Date('2000-01-01');
    const fechaActual = new Date();
    
    const wrapper = this.closest('.field-wrapper');
    let feedback = wrapper.querySelector('.field-feedback');
    
    if (!feedback) {
      feedback = document.createElement('div');
      feedback.className = 'field-feedback';
      wrapper.appendChild(feedback);
    }

    if (!this.value) {
      feedback.innerHTML = '';
      wrapper.classList.remove('valid', 'invalid');
      return;
    }

    let isValid = true;
    let message = '';

    // Validar que no sea antes del año 2000
    if (fechaSeleccionada < fechaMinima) {
      isValid = false;
      message = 'La fecha de nacimiento debe ser del año 2000 en adelante';
    }
    // Validar que no sea fecha futura
    else if (fechaSeleccionada > fechaActual) {
      isValid = false;
      message = 'La fecha de nacimiento no puede ser futura';
    }
    // Validar edad mínima (opcional: al menos 18 años)
    else {
      const edad = Math.floor((fechaActual - fechaSeleccionada) / (365.25 * 24 * 60 * 60 * 1000));
      if (edad < 18) {
        isValid = false;
        message = 'Debe ser mayor de 18 años';
      }
    }

    if (isValid) {
      feedback.innerHTML = '<i class="bi bi-check-circle text-success"></i> Fecha válida';
      feedback.className = 'field-feedback valid';
      wrapper.classList.add('valid');
      wrapper.classList.remove('invalid');
    } else {
      feedback.innerHTML = `<i class="bi bi-x-circle text-danger"></i> ${message}`;
      feedback.className = 'field-feedback invalid';
      wrapper.classList.add('invalid');
      wrapper.classList.remove('valid');
    }
  });

  // Agregar validación al envío del formulario
  form.addEventListener('submit', function(event) {
    const fechaSeleccionada = new Date(fechaNacimientoField.value);
    const fechaMinima = new Date('2000-01-01');
    
    if (fechaSeleccionada < fechaMinima) {
      event.preventDefault();
      event.stopPropagation();
      
      // Mostrar error y hacer scroll al campo
      const wrapper = fechaNacimientoField.closest('.field-wrapper');
      wrapper.classList.add('error-shake');
      setTimeout(() => wrapper.classList.remove('error-shake'), 600);
      
      fechaNacimientoField.scrollIntoView({ behavior: 'smooth', block: 'center' });
      fechaNacimientoField.focus();
    }
  });
}
    // Efectos de focus en campos
    const fieldInputs = form.querySelectorAll('input, select, textarea');
    fieldInputs.forEach(input => {
      input.addEventListener('focus', function() {
        const wrapper = this.closest('.field-wrapper');
        if (wrapper) wrapper.classList.add('focused');
      });

      input.addEventListener('blur', function() {
        const wrapper = this.closest('.field-wrapper');
        if (wrapper) {
          wrapper.classList.remove('focused');
          if (this.value.trim()) {
            wrapper.classList.add('has-value');
          } else {
            wrapper.classList.remove('has-value');
          }
        }
      });

      // Verificar valores iniciales
      if (input.value.trim()) {
        const wrapper = input.closest('.field-wrapper');
        if (wrapper) wrapper.classList.add('has-value');
      }
    });
  }
});
</script>

<style>
:root {
  --primary: #1a3b68;
  --accent: #ffcc33;  
  --white: #ffffff;
  --light: #f8f9fa;
  --border: #e9ecef;
  --text: #2c3e50;
  --text-light: #6c757d;
  --shadow: rgba(26, 59, 104, 0.1);
  --success: #10b981;
  --error: #dc2626;
  --warning: #f59e0b;
}

* {
  box-sizing: border-box;
}

body, html {
  margin: 0;
  padding: 0;
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: linear-gradient(135deg, var(--light) 0%, #e3f2fd 100%);
  color: var(--text);
  line-height: 1.6;
}

.admin-container {
  min-height: 100vh;
  padding: 2rem 0;
}

/* Header Section */
.header-section {
  text-align: center;
  margin-bottom: 3rem;
}

.header-icon {
  width: 100px;
  height: 100px;
  background: var(--primary);
  border-radius: 50%;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 1.5rem;
  position: relative;
  overflow: hidden;
}

.header-icon i {
  font-size: 2.5rem;
  color: var(--white);
  z-index: 2;
}

.header-icon::before {
  content: '';
  position: absolute;
  inset: -50%;
  background: conic-gradient(var(--accent), transparent, var(--accent));
  animation: rotate 4s linear infinite;
  z-index: 1;
}

.header-icon::after {
  content: '';
  position: absolute;
  inset: 4px;
  background: var(--primary);
  border-radius: 50%;
  z-index: 1;
}

.header-title {
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--primary);
  margin: 0 0 1rem 0;
  letter-spacing: -0.02em;
}

.header-divider {
  width: 80px;
  height: 4px;
  background: linear-gradient(90deg, var(--primary), var(--accent));
  margin: 0 auto;
  border-radius: 2px;
}

@keyframes rotate {
  to { transform: rotate(360deg); }
}

/* Form Container */
.form-container {
  background: var(--white);
  border-radius: 24px;
  padding: 3rem;
  box-shadow: 0 20px 60px var(--shadow);
  border: 1px solid var(--border);
  position: relative;
  max-width: none;
}

.form-container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 6px;
  background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
  border-radius: 24px 24px 0 0;
}

/* Success Section */
.success-section {
  background: #f0fdf4;
  border: 1px solid #bbf7d0;
  border-left: 4px solid var(--success);
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 2rem;
}

.success-header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--success);
  font-weight: 600;
}

/* Error Section */
.error-section {
  background: #fff5f5;
  border: 1px solid #fecaca;
  border-left: 4px solid var(--error);
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 2rem;
}

.error-header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--error);
  font-weight: 600;
  margin-bottom: 1rem;
}

.error-list {
  margin: 0;
  padding-left: 1.5rem;
  color: #991b1b;
}

.error-list li {
  margin-bottom: 0.5rem;
}

/* Form Sections */
.form-section {
  margin-bottom: 3rem;
}

.section-title {
  display: grid;
  grid-template-columns: auto 1fr auto;
  align-items: center;
  gap: 1.5rem;
  margin-bottom: 2rem;
  padding: 1.5rem;
  background: linear-gradient(135deg, var(--light) 0%, var(--white) 100%);
  border-radius: 16px;
  border: 1px solid var(--border);
}

.section-number {
  width: 50px;
  height: 50px;
  background: var(--primary);
  color: var(--white);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 1.2rem;
}

.section-info h3 {
  margin: 0 0 0.25rem 0;
  font-size: 1.3rem;
  font-weight: 600;
  color: var(--primary);
}

.section-info p {
  margin: 0;
  color: var(--text-light);
  font-size: 0.95rem;
}

.section-icon {
  font-size: 1.8rem;
  color: var(--accent);
  background: var(--primary);
  padding: 0.75rem;
  border-radius: 12px;
}

/* Fields Grid - Mejorado para más espacio horizontal */
.fields-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 2rem;
}

.field-group {
  display: flex;
  flex-direction: column;
}

.field-group.col-span-2 {
  grid-column: 1 / -1;
}

.field-label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.75rem;
  font-weight: 500;
  color: var(--text);
}

.field-label i {
  color: var(--primary);
  font-size: 1.1rem;
}

.required {
  color: var(--error);
  font-weight: 600;
  margin-left: 0.25rem;
}

.auto-text {
  color: var(--accent);
  font-weight: 400;
  font-style: italic;
  margin-left: 0.5rem;
}

.field-wrapper {
  position: relative;
}

.field-wrapper input,
.field-wrapper select,
.field-wrapper textarea {
  width: 100%;
  padding: 1rem 1.25rem;
  border: 2px solid var(--border);
  border-radius: 12px;
  font-size: 1rem;
  background: var(--white);
  transition: all 0.3s ease;
  outline: none;
}

.field-wrapper input:focus,
.field-wrapper select:focus,
.field-wrapper textarea:focus {
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(26, 59, 104, 0.1);
}

.field-wrapper.focused input,
.field-wrapper.focused select,
.field-wrapper.focused textarea {
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(26, 59, 104, 0.1);
}

.field-wrapper.valid input,
.field-wrapper.valid select,
.field-wrapper.valid textarea {
  border-color: var(--success);
  background: #f0fdf4;
}

.field-wrapper.invalid input,
.field-wrapper.invalid select,
.field-wrapper.invalid textarea {
  border-color: var(--error);
  background: #fef2f2;
}

.field-indicator {
  position: absolute;
  bottom: -2px;
  left: 0;
  width: 0;
  height: 2px;
  background: var(--accent);
  transition: width 0.3s ease;
  border-radius: 0 0 12px 12px;
}

.field-wrapper.focused .field-indicator {
  width: 100%;
}

.field-wrapper.valid .field-indicator {
  background: var(--success);
  width: 100%;
}

.field-wrapper.invalid .field-indicator {
  background: var(--error);
  width: 100%;
}

.field-wrapper.has-value input,
.field-wrapper.has-value select,
.field-wrapper.has-value textarea {
  border-color: var(--primary);
  background: #f8faff;
}

/* Password Toggle */
.password-toggle {
  position: absolute;
  right: 1rem;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: var(--text-light);
  cursor: pointer;
  font-size: 1.1rem;
  padding: 0.5rem;
  border-radius: 50%;
  transition: all 0.3s ease;
}

.password-toggle:hover {
  background: var(--light);
  color: var(--primary);
}

/* Password Strength Indicator */
.password-strength {
  margin-top: 0.5rem;
}

.strength-bar {
  width: 100%;
  height: 4px;
  background: var(--border);
  border-radius: 2px;
  overflow: hidden;
  margin-bottom: 0.5rem;
}

.strength-fill {
  height: 100%;
  transition: all 0.3s ease;
  border-radius: 2px;
}

.strength-text {
  font-size: 0.85rem;
  font-weight: 500;
}

/* Field Feedback */
.field-feedback {
  margin-top: 0.5rem;
  font-size: 0.85rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.field-feedback.valid {
  color: var(--success);
}

.field-feedback.invalid {
  color: var(--error);
}

.field-hint {
  margin-top: 0.25rem;
  font-size: 0.8rem;
  color: var(--text-light);
  font-style: italic;
}

/* Error shake animation */
@keyframes errorShake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}

.error-shake {
  animation: errorShake 0.6s ease-in-out;
}

/* Form Summary */
.form-summary {
  background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
  border: 1px solid #bbdefb;
  border-radius: 16px;
  padding: 2rem;
  margin-bottom: 2rem;
  text-align: center;
}

.form-summary h4 {
  color: var(--primary);
  margin: 0 0 1rem 0;
  font-size: 1.2rem;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.form-summary p {
  color: var(--text-light);
  margin: 0;
  font-size: 0.95rem;
}

/* Submit Section */
.submit-section {
  margin-top: 3rem;
  text-align: center;
}

.submit-btn {
  background: linear-gradient(135deg, var(--primary) 0%, #2563eb 100%);
  color: var(--white);
  border: none;
  padding: 1.25rem 3rem;
  border-radius: 50px;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
  display: inline-block;
  min-width: 320px;
  box-shadow: 0 8px 25px rgba(26, 59, 104, 0.2);
}

.submit-btn:hover:not(:disabled) {
  transform: translateY(-3px);
  box-shadow: 0 15px 35px rgba(26, 59, 104, 0.3);
}

.submit-btn:active {
  transform: translateY(-1px);
}

.submit-btn:disabled {
  opacity: 0.8;
  cursor: not-allowed;
  transform: none;
}

.btn-content,
.btn-loading {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
}

.submit-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, var(--accent), transparent);
  transition: left 0.8s;
}

.submit-btn:hover::before {
  left: 100%;
}

.submit-info {
  margin-top: 1.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  color: var(--text-light);
  font-size: 0.9rem;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}

.submit-info i {
  color: var(--accent);
  font-size: 1.1rem;
}

/* Spin animation */
.spin {
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Responsive Design - Mejorado para aprovechar más espacio */
@media (min-width: 1400px) {
  .fields-grid {
    grid-template-columns: repeat(4, 1fr);
  }
  
  .field-group.col-span-2 {
    grid-column: span 2;
  }
}

@media (min-width: 1200px) {
  .fields-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}

@media (min-width: 992px) {
  .admin-container {
    padding: 2rem 1rem;
  }
  
  .form-container {
    padding: 4rem;
  }
}

@media (max-width: 991px) {
  .fields-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 768px) {
  .admin-container {
    padding: 1rem 0.5rem;
  }

  .form-container {
    padding: 2rem 1.5rem;
    border-radius: 16px;
  }

  .header-title {
    font-size: 2rem;
  }

  .header-icon {
    width: 80px;
    height: 80px;
  }

  .header-icon i {
    font-size: 2rem;
  }

  .fields-grid {
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }

  .field-group.col-span-2 {
    grid-column: span 1;
  }

  .section-title {
    grid-template-columns: 1fr;
    text-align: center;
    gap: 1rem;
    padding: 1.5rem 1rem;
  }

  .submit-btn {
    min-width: auto;
    width: 100%;
    padding: 1rem 2rem;
  }

  .form-summary {
    padding: 1.5rem;
  }
}

@media (max-width: 480px) {
  .form-container {
    padding: 1.5rem 1rem;
  }

  .header-title {
    font-size: 1.75rem;
  }

  .section-title {
    padding: 1rem;
  }

  .fields-grid {
    gap: 1rem;
  }

  .field-wrapper input,
  .field-wrapper select,
  .field-wrapper textarea {
    padding: 0.875rem 1rem;
    font-size: 0.95rem;
  }
}

/* Mejoras adicionales para la experiencia de usuario */
.field-wrapper input[type="date"] {
  color-scheme: light;
}

.field-wrapper input[type="date"]::-webkit-calendar-picker-indicator {
  color: var(--primary);
  cursor: pointer;
}

.field-wrapper select {
  cursor: pointer;
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
  background-position: right 0.75rem center;
  background-repeat: no-repeat;
  background-size: 1.5em 1.5em;
  padding-right: 2.5rem;
}

.field-wrapper select:focus {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%231a3b68' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
}

/* Animaciones adicionales */
.form-section {
  animation: fadeInUp 0.6s ease forwards;
}

.form-section:nth-child(2) {
  animation-delay: 0.1s;
}

.form-section:nth-child(3) {
  animation-delay: 0.2s;
}

.form-section:nth-child(4) {
  animation-delay: 0.3s;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Scroll suave para toda la página */
html {
  scroll-behavior: smooth;
}

/* Mejoras en accesibilidad */
.field-wrapper input:focus,
.field-wrapper select:focus,
.field-wrapper textarea:focus {
  outline: 2px solid var(--primary);
  outline-offset: 2px;
}

/* Estados de validación mejorados */
.was-validated .field-wrapper input:valid,
.was-validated .field-wrapper select:valid,
.was-validated .field-wrapper textarea:valid {
  border-color: var(--success);
  background: #f0fdf4;
}

.was-validated .field-wrapper input:invalid,
.was-validated .field-wrapper select:invalid,
.was-validated .field-wrapper textarea:invalid {
  border-color: var(--error);
  background: #fef2f2;
}

/* Tooltips personalizados */
[data-tooltip] {
  position: relative;
  cursor: help;
}

[data-tooltip]:before {
  content: attr(data-tooltip);
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: var(--text);
  color: var(--white);
  padding: 0.5rem 1rem;
  border-radius: 6px;
  font-size: 0.8rem;
  white-space: nowrap;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  z-index: 1000;
}

[data-tooltip]:hover:before {
  opacity: 1;
  visibility: visible;
  bottom: calc(100% + 8px);
}

/* Indicadores de carga mejorados */
.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255, 255, 255, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
}

.loading-overlay.active {
  opacity: 1;
  visibility: visible;
}

.loading-spinner {
  width: 50px;
  height: 50px;
  border: 4px solid var(--border);
  border-top: 4px solid var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}
</style>
{% endblock %}